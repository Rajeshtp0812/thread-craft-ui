name: Build and Serve Angular App

on:
    push:
        branches:
            - master # Adjust this to your main branch name

jobs:
    build-and-serve:
        name: Build and Serve
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v2

            - name: Set up Node.js
              uses: actions/setup-node@v2
              with:
                  node-version: 16.15.1 # Change this to your desired Node.js version

            - name: Install Angular CLI
              run: npm install -g @angular/cli

            - name: Install Dependencies and Build
              run: |
                  npm install
                  ng build

            - name: Write SSH private key to file
              run: |
                  echo "${{ secrets.SSH_PRIVATE_KEY }}" > private_key.pem
                  chmod 600 private_key.pem

            - name: Deploy to cPanel
              run: |
                  scp -r -o StrictHostKeyChecking=no -i private_key.pem dist/* clpcrmti@clpcrm.com:/home/clpcrmti/public_html/thread-craft

"use strict";(self.webpackChunkthread_craft=self.webpackChunkthread_craft||[]).push([[32],{8032:(B,C,i)=>{i.r(C),i.d(C,{CompaniesModule:()=>L});var d=i(6814),f=i(9854),r=i(5861),p=i(9140),e=i(4946),g=i(9805),c=i(5219),_=i(7949),y=i(7213),h=i(707),s=i(4685),v=i(9897),x=i(3259),T=i(3714);const b=["cm"],F=function(){return{header:"true"}};function M(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",8)(1,"span",9),e._UZ(2,"i",10),e.TgZ(3,"input",11),e.NdJ("input",function(a){e.CHM(t);const m=e.oxw(),u=e.MAs(1);return e.KtG(m.onGlobalFilter(u,a))}),e.qZA()(),e.TgZ(4,"div",12),e.NdJ("click",function(a){e.CHM(t);const m=e.oxw();return e.KtG(m.onContextMenu(a,"tableMenu"))}),e._UZ(5,"i",13),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("disabled",0===(null==t.data?null:t.data.length)),e.xp6(1),e.Q6J("pContextMenuRow",e.DdM(2,F))}}function D(n,l){if(1&n&&(e.TgZ(0,"th",16),e._uU(1),e._UZ(2,"p-sortIcon",17),e.qZA()),2&n){const t=l.$implicit;e.s9C("pSortableColumn",t.field),e.xp6(1),e.hij(" ",t.header,""),e.xp6(1),e.s9C("field",t.field)}}function Z(n,l){if(1&n&&(e.TgZ(0,"tr"),e.YNc(1,D,3,3,"th",14),e._UZ(2,"th",15),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.cols)}}function S(n,l){if(1&n&&(e.TgZ(0,"td",21),e._uU(1),e.qZA()),2&n){const t=l.$implicit,o=e.oxw().$implicit;e.s9C("pTooltip",o[t.field]),e.xp6(1),e.hij(" ",o[t.field]," ")}}function A(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"tr"),e.YNc(1,S,2,2,"td",18),e.TgZ(2,"td",19)(3,"div")(4,"i",20),e.NdJ("click",function(a){const u=e.CHM(t).$implicit,V=e.oxw();return e.KtG(V.onContextMenu(a,"rowMenu",u))}),e.qZA()()()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.cols)}}function N(n,l){1&n&&(e.TgZ(0,"td",23),e._uU(1," No record found. "),e.qZA())}function z(n,l){1&n&&(e.TgZ(0,"td",23),e._uU(1," No data to display. "),e.qZA())}function J(n,l){if(1&n&&(e.TgZ(0,"tr"),e.YNc(1,N,2,0,"td",22),e.YNc(2,z,2,0,"td",22),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.isDataLoading&&(null==t.data?null:t.data.length)),e.xp6(1),e.Q6J("ngIf",!(t.isDataLoading||null!=t.data&&t.data.length))}}const w=function(){return["code"]};let I=(()=>{class n{constructor(t,o){this.companyService=t,this.messageService=o,this.isDataLoading=!1,this.cols=[{field:"companyName",header:"Company"},{field:"email",header:"Email"},{field:"contact",header:"Contact"},{field:"state",header:"State"},{field:"city",header:"City"},{field:"address",header:"Address"},{field:"gst",header:"GST"}],this.data=[],this.frozen=!0,this.openCompaniesForm=new e.vpe,this.filterFields=[]}ngOnInit(){this.filterFields=this.cols.map(t=>t.field),this.fetchData(),this.companyService.refetchData.subscribe(t=>this.fetchData())}fetchData(){var t=this;return(0,r.Z)(function*(){t.isDataLoading=!0;try{let o=yield t.companyService.getCompanies();t.data=o.data}catch{t.messageService.add({severity:"error",summary:"Unexpected system error",detail:""})}finally{t.isDataLoading=!1}})()}onContextMenu(t,o,a=null){t.preventDefault(),"tableMenu"===o?this.contextMenus=[{label:"Add",data:a,command:()=>this.openCompaniesForm.emit({modalType:p.fG.ADD,data:null})}]:("rowMenu"===o||"contextmenu"===t.type)&&(this.contextMenus=[{label:"Edit",data:a,command:m=>this.openCompaniesForm.emit({modalType:p.fG.EDIT,data:m})},{label:"Delete",data:a,command:m=>this.deleteCompany(m)}]),this.contextMenu.show(t)}deleteCompany(t){var o=this;return(0,r.Z)(function*(){if(1!==o.data.length)try{yield o.companyService.deleteCompany(t.item.data.companyId),o.companyService.refetchData.next(!0)}catch{o.messageService.add({severity:"error",summary:"Unexpected system error",detail:""})}else o.messageService.add({severity:"info",summary:"Cannot delete. At least one company must remain",detail:""})})()}onGlobalFilter(t,o){t.filterGlobal(o.target.value,"contains")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(g.t),e.Y36(c.ez))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-companies-table"]],viewQuery:function(t,o){if(1&t&&e.Gf(b,5),2&t){let a;e.iGM(a=e.CRH())&&(o.contextMenu=a.first)}},outputs:{openCompaniesForm:"openCompaniesForm"},decls:8,vars:15,consts:[["responsiveLayout","scroll","dataKey","id","scrollDirection","horizontal","scrollHeight","385px",3,"value","columns","rows","globalFilterFields","rowHover","resizableColumns","contextMenu","reorderableColumns","loading","scrollable","virtualScroll","virtualScrollItemSize"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["triggerEvent","click",3,"model"],["cm",""],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Search...",1,"w-full","sm:w-auto",3,"disabled","input"],[3,"pContextMenuRow","click"],[1,"pi","pi-ellipsis-v","action-menu"],["pResizableColumn","","pReorderableColumn","",3,"pSortableColumn",4,"ngFor","ngForOf"],["alignFrozen","right","pFrozenColumn","",2,"max-width","5px"],["pResizableColumn","","pReorderableColumn","",3,"pSortableColumn"],[3,"field"],["pResizableColumn","","class","p-text-nowrap p-text-truncate","tooltipPosition","bottom",3,"pTooltip",4,"ngFor","ngForOf"],["alignFrozen","right","pFrozenColumn","",2,"width","5px"],[1,"pi","pi-ellipsis-h","action-menu",3,"click"],["pResizableColumn","","tooltipPosition","bottom",1,"p-text-nowrap","p-text-truncate",3,"pTooltip"],["colspan","cols?.length",4,"ngIf"],["colspan","cols?.length"]],template:function(t,o){if(1&t&&(e.TgZ(0,"p-table",0,1),e.YNc(2,M,6,3,"ng-template",2),e.YNc(3,Z,3,1,"ng-template",3),e.YNc(4,A,5,1,"ng-template",4),e.YNc(5,J,3,2,"ng-template",5),e.qZA(),e._UZ(6,"p-contextMenu",6,7)),2&t){const a=e.MAs(7);e.Q6J("value",o.data)("columns",o.cols)("rows",20)("globalFilterFields",o.filterFields)("rowHover",!0)("resizableColumns",!0)("contextMenu",a)("globalFilterFields",e.DdM(14,w))("reorderableColumns",!0)("loading",o.isDataLoading)("scrollable",!0)("virtualScroll",!0)("virtualScrollItemSize",40),e.xp6(6),e.Q6J("model",o.contextMenus)}},dependencies:[d.sg,d.O5,s.iA,c.jx,s.lQ,s.on,s.zi,s.Q7,s.Af,s.fz,v.xV,x.u,T.o]}),n})();function G(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.closeForm())}),e.qZA(),e.TgZ(1,"button",6),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.saveCompany())}),e.qZA()}if(2&n){const t=e.oxw();e.xp6(1),e.s9C("label","edit"===t.selectedModal?"Save":"Create"),e.Q6J("disabled",!t.isFormValid)}}const O=function(){return{width:"650px"}},Q=[{path:"companies",component:(()=>{class n{constructor(t,o){this.companyService=t,this.messageService=o,this.isCompanyFormOpen=!1,this.editCompanyDetail=null,this.isFormValid=!1,this.formData=null,this.selectedCompany=JSON.parse(localStorage.getItem(p.j1))}openCompaniesForm(t){this.isCompanyFormOpen=!this.isCompanyFormOpen,this.editCompanyDetail=null,this.selectedModal=t.modalType,t?.modalType===p.fG.EDIT&&(this.editCompanyDetail=t.data.item.data)}closeForm(){this.isCompanyFormOpen=!1}setFormData(t){var o=this;return(0,r.Z)(function*(){o.isFormValid=t.status,o.formData=t.data})()}saveCompany(){var t=this;return(0,r.Z)(function*(){if(t.isFormValid)try{t.selectedModal===p.fG.ADD?(yield t.companyService.createCompany(t.formData),t.messageService.add({severity:"success",summary:"Company created successfully",detail:""})):t.selectedModal===p.fG.EDIT&&(yield t.companyService.updateCompany(t.editCompanyDetail.companyId,t.formData),t.selectedCompany.companyId===t.editCompanyDetail.companyId&&(t.selectedCompany.companyName=t.formData.companyName,localStorage.setItem(p.j1,JSON.stringify(structuredClone(t.selectedCompany))),t.companyService.changedCompanyLabel.next(!0)),t.messageService.add({severity:"success",summary:"Company updated succesfully",detail:""})),t.closeForm(),t.companyService.refetchData.next(!0)}catch{t.messageService.add({severity:"error",summary:"Unexpected system error",detail:""})}})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(g.t),e.Y36(c.ez))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-companies-main"]],decls:7,vars:12,consts:[[1,"col-12","card"],[3,"openCompaniesForm"],[1,"p-fluid",3,"visible","header","modal","resizable","closable","maximizable","visibleChange"],[3,"wrapperComponentName","updateFormData","clearForm","formData"],["pTemplate","footer"],["pButton","","pRipple","","type","button","label","Cancel",1,"p-button-raised","p-button-secondary",3,"click"],["pButton","","pRipple","","type","button",1,"p-button-raised",3,"label","disabled","click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"h5"),e._uU(2,"Companies"),e.qZA(),e.TgZ(3,"app-companies-table",1),e.NdJ("openCompaniesForm",function(m){return o.openCompaniesForm(m)}),e.qZA()(),e.TgZ(4,"p-dialog",2),e.NdJ("visibleChange",function(m){return o.isCompanyFormOpen=m}),e.TgZ(5,"app-common-form",3),e.NdJ("formData",function(m){return o.setFormData(m)}),e.qZA(),e.YNc(6,G,2,2,"ng-template",4),e.qZA()),2&t&&(e.xp6(4),e.Akn(e.DdM(11,O)),e.s9C("header","edit"===o.selectedModal?"Edit Company Details":"Create New Company"),e.Q6J("visible",o.isCompanyFormOpen)("modal",!0)("resizable",!0)("closable",!1)("maximizable",!0),e.xp6(1),e.Q6J("wrapperComponentName","company")("updateFormData",o.editCompanyDetail)("clearForm",o.isCompanyFormOpen))},dependencies:[_.V,c.jx,y.V,h.Hq,I]}),n})()}];let R=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[f.Bz.forChild(Q),f.Bz]}),n})();var U=i(1122),Y=i(6218),j=i(2352),E=i(95),H=i(2662);let L=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[d.ez,H._,E.u5,R,s.U$,v.vI,U.$9,T.j,y.S,h.hJ,x.z,Y.A,j.kW]}),n})()}}]);